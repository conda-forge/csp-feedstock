From c0fb44b8e9f19a7b363a234f158167d73e7d09f7 Mon Sep 17 00:00:00 2001
From: Tim Paine <3105306+timkpaine@users.noreply.github.com>
Date: Wed, 24 Sep 2025 19:29:24 -0400
Subject: [PATCH] arrow-20-21

---
 cpp/csp/adapters/parquet/ParquetFileReaderWrapper.cpp | 7 +++++++
 cpp/csp/adapters/parquet/ParquetFileWriterWrapper.cpp | 6 +++++-
 2 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/cpp/csp/adapters/parquet/ParquetFileReaderWrapper.cpp b/cpp/csp/adapters/parquet/ParquetFileReaderWrapper.cpp
index 3e29926..9f8f112 100644
--- a/cpp/csp/adapters/parquet/ParquetFileReaderWrapper.cpp
+++ b/cpp/csp/adapters/parquet/ParquetFileReaderWrapper.cpp
@@ -2,6 +2,7 @@
 #include <csp/adapters/parquet/ParquetStatusUtils.h>
 #include <parquet/arrow/reader.h>
 #include <arrow/io/file.h>
+#include <arrow/util/config.h>
 
 namespace csp::adapters::parquet
 {
@@ -16,9 +17,15 @@ void ParquetFileReaderWrapper::open( const std::string &fileName )
 
     try
     {
+#if ARROW_VERSION_MAJOR == 20 || ARROW_VERSION_MAJOR == 21
+        auto res = ::parquet::arrow::OpenFile(m_inputFile, arrow::default_memory_pool());
+        STATUS_OK_OR_THROW_RUNTIME(res.status(), "Failed to open parquet file " << fileName );
+        m_fileReader = res.MoveValueUnsafe();
+#else
         STATUS_OK_OR_THROW_RUNTIME(
                 ::parquet::arrow::OpenFile( m_inputFile, arrow::default_memory_pool(), &m_fileReader ),
                 "Failed to open parquet file " << fileName );
+#endif
     }
     catch( ... )
     {
diff --git a/cpp/csp/adapters/parquet/ParquetFileWriterWrapper.cpp b/cpp/csp/adapters/parquet/ParquetFileWriterWrapper.cpp
index 40d9e0d..42586e1 100644
--- a/cpp/csp/adapters/parquet/ParquetFileWriterWrapper.cpp
+++ b/cpp/csp/adapters/parquet/ParquetFileWriterWrapper.cpp
@@ -2,6 +2,7 @@
 #include <csp/adapters/parquet/ParquetStatusUtils.h>
 #include <arrow/io/file.h>
 #include <arrow/table.h>
+#include <arrow/util/config.h>
 #include <parquet/arrow/writer.h>
 
 namespace csp::adapters::parquet
@@ -16,8 +17,11 @@ void ParquetFileWriterWrapper::openImpl( const std::string &fileName, const std:
 
     ::parquet::WriterProperties::Builder builder;
     builder.compression( resolveCompression( compression ));
+#if ARROW_VERSION_MAJOR == 20 || ARROW_VERSION_MAJOR == 21
+    builder.version(::parquet::ParquetVersion::PARQUET_2_6 );
+#else
     builder.version(::parquet::ParquetVersion::PARQUET_2_0 );
-
+#endif
     ::parquet::ArrowWriterProperties::Builder arrowBuilder;
     arrowBuilder.store_schema();
 
-- 
2.43.0

